# A Complete Development Setup

To setup a complete development environment, we need also the Graal just-in-time
compiler, and Node.js to work on the Kompos Web Debugger.

On Ubuntu, the necessary software can be installed with:

```bash
## First, installing Node.js and the Node Package Manager (NPM)
curl -sL https://deb.nodesource.com/setup_9.x | sudo -E bash -
sudo apt install npm nodejs

## Second, installing and compiling the Graal JIT Compiler
cd .. ## leaving the SOMns folder
git clone --recursive https://github.com/smarr/GraalBasic.git
cd GraalBasic
yes "n" | ./build.sh
cd ../SOMns
ant ## to ensure everything is compiled
```

At this point, it should be possible to use Graal to run SOMns by dropping the
`-G` option from the command line:

```bash
./som core-lib/Hello.ns
```

<figure style="float: right; margin-right: -100px">
<img style="width: 200px;" src="../eclipse-project-outline.png" alt="Eclipse Project outline" />
<figcaption>
Eclipse Project outline.
</figcaption>
</figure>

## Eclipse to Develop the Interpreter

SOMns is currently developed with Eclipse. While other Java IDEs can also be
used, for brevity, we'll focus on Eclipse only.

At the time of writing, I am using [Eclipse Neon 4.6](https://eclipse.org/downloads/).
Please also install the **Eclipse Checkstyle Plugin** from the [Eclipse Marketplace](http://eclipse-cs.sourceforge.net/#!/install).

For development, we also need to setup all Eclipse projects:

```bash
ant ideinit
```

After the Eclipse projects for the Truffle library were generated by this step,
we can import the *existing* projects into Eclipse with *File* -> *Import...* ->
*Existing Projects into Workspace* and pointing Eclipse to the SOMns folder.

I like to import the Truffle projects into a separate Truffle working set. This
makes working in Eclipse with many projects easier.

The result should be looking roughly, but not exactly like in the screenshot on
the right.

For debugging the interpreter with Eclipse, create a Eclipse run configuration
for the SOMns project. The main class is `som.VM`. To run for instance  the
Mandelbrot benchmark, add the following as program arguments:

    core-lib/Benchmarks/Harness.ns Mandelbrot 2 0 500

In VM arguments, enable assertions with:

    -ea -esa

I personally start the various SOMns programs from the command line:

```bash
./som -d -G core-lib/Benchmarks/Harness.ns Mandelbrot 2 0 500
```

For this approach, we need a *Remote Java Application* debug configuration
in Eclipse. After starting SOMns, it should tell you that it is waiting on port
`8000`, which is used as the port in the Eclipse debug configuration.

## Summary

A brief list of steps:

1. Install software dependencies: ant, git, Java 8, Eclipse 4.6 (or later),
   VS Code 1.8 (or later), Node.js, NPM, Graal JIT compiler

2. Create Truffle Eclipse projects: `ant ideinit`

3. Import Eclipse projects

4. Run `ant` from the command line or Eclipse
